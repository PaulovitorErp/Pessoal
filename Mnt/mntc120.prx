#INCLUDE "mntc120.ch"
#INCLUDE "PROTHEUS.CH"

#DEFINE _nVERSAO 1 //Versao do fonte
/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTC120   ³ Autor ³ Inacio Luiz Kolling   ³ Data ³ 02/07/97 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Monta um browse das ordens de servico de Manutencao        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTC120                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function MNTC120(lPerg,lPerg1,lPerg2)   
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Armazena variaveis p/ devolucao (NGRIGHTCLICK) 				  		  	  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local aNGBEGINPRM := NGBEGINPRM(_nVERSAO)
Local cOldFun := FunName()
Local OldRot
Local ccondicao
Private cCadastro := OemtoAnsi(STR0001) //"Ordem Servico Manutencao"
lCORRET := .F.
OldRot  := aCLONE(aROTINA)
SetFunName('MNTC120')

aRotina := MenuDef()
// A função NGVISUAL deve ser declarada no MenuDef pois ela que será chamada na execução do botão após o ajuste
// do aRotina realizado na função NGCONSULTA
aRotina[1, 2] := 'NGCAD01'

// ESTAS FUNCOES ESTAO NO MNTC550.PRX
vPerg := If(lPerg = Nil,.t.,.f.)

If vPerg
   Return
Else
   MV_PAR01 := lPerg
   MV_PAR02 := lPerg1
   MV_PAR05 := lPerg2  // SEQUENCIA DA MANUTENCAO
EndIf

DbSelectArea("STJ")
DbSetOrder(2)                      
cKey := "B"+MV_PAR01+MV_PAR02+MV_PAR05                      

bWHILE := {|| !Eof() .And. STJ->TJ_TIPOOS == "B" .And. STJ->TJ_CODBEM == MV_PAR01 .And. ;
               STJ->TJ_SERVICO == MV_PAR02 .And. STJ->TJ_SEQRELA == MV_PAR05}

bFOR   := {|| TJ_FILIAL  == xFilial("STJ") }

NGCONSULTA("TRBJ", cKEY, bWHILE, bFOR, aRotina,{})

DbSelectArea("STJ")
DbSetOrder(1)
aRotina := aCLONE(OldRot) 
SetFunName(cOldFun)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Devolve variaveis armazenadas (NGRIGHTCLICK)                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
NGRETURNPRM(aNGBEGINPRM)

Return

//-------------------------------------------------------------------
/*/{Protheus.doc} MenuDef
Menu de opções

@type   Function

@author João Ricardo Santini Zandoná
@since  15/03/2024

@return Array, opções disponiveis na rotina
/*/
//-------------------------------------------------------------------
Static Function MenuDef()

	Local aReturn := {{STR0003,"NGVISUAL"  , 0, 2},;     //"Visual."
                     {STR0004,"MNTC550D" , 0, 3},;     //"Detalhes"
                     {STR0005,"MNTC550E"  , 0, 4},;    //"Ocorren."
                     {STR0006,"MNTC550A", 0, 4},;      //"proBlemas" 
                     {STR0008,"NGATRASOS" , 0, 4,0},;  //"Motivo Atraso"
                     {STR0007,"MNTC550B"  , 0, 4}}     //"Etapas   "

Return aReturn
